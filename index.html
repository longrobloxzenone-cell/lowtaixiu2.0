<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Royal Casino - V131 Lobby</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <style>
        /* CSS CHI TI·∫æT T·ªêI ƒêA - CAM K·∫æT N·∫∂NG FILE */
        * { box-sizing: border-box; -webkit-tap-highlight-color: rgba(0,0,0,0); outline: none; margin: 0; padding: 0; }
        html, body { background-color: #000; background-image: radial-gradient(circle at 50% 50%, #4a0000 0%, #2a0000 45%, #000 100%); background-attachment: fixed; color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; overflow-x: hidden; min-height: 100vh; }
        #loginPanel, #lobbyPanel { width: 100%; max-width: 500px; margin: 0 auto; padding: 25px 20px; }
        .login-card { background-color: rgba(10, 10, 10, 0.98); padding: 55px 35px; border-radius: 50px; border: 2px solid rgba(255, 215, 0, 0.4); text-align: center; box-shadow: 0 40px 100px #000; }
        #logStatusText { color: #ffd700; font-size: 10px; margin-bottom: 30px; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; animation: blink-log 2s infinite; }
        @keyframes blink-log { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        .sad-input { width: 100%; padding: 20px; background-color: #050505; border: 1px solid #333; color: #fff; border-radius: 20px; margin-bottom: 15px; font-size: 16px; }
        .btn-main { width: 100%; padding: 24px; background-image: linear-gradient(135deg, #ffd700 0%, #b8860b 100%); color: #000; font-weight: 900; font-size: 20px; border-radius: 20px; border: none; cursor: pointer; text-transform: uppercase; }
        .marquee-box { width: 100%; background: rgba(255, 215, 0, 0.08); border: 1px solid rgba(255, 215, 0, 0.25); border-radius: 20px; padding: 14px 0; margin-bottom: 25px; overflow: hidden; }
        .marquee-text { display: inline-block; white-space: nowrap; color: #ffd700; font-size: 15px; font-weight: 900; animation: marquee-run 16s linear infinite; }
        @keyframes marquee-run { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        #lockBanner { background: linear-gradient(to right, #b71c1c, #ff0000); color: #fff; padding: 18px; text-align: center; font-weight: 900; border-radius: 25px; border: 2px solid #fff; margin-bottom: 25px; display: none; box-shadow: 0 0 30px rgba(255,0,0,0.6); }
        .btn-play-card { padding: 50px 10px; border-radius: 45px; border: 2px solid rgba(255, 215, 0, 0.35); cursor: pointer; margin-bottom: 35px; text-align: center; background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), transparent); }
        .slogan-ultimate { color: #999; font-size: 3.2vw; max-font-size: 13px; margin-top: 15px; font-style: italic; font-weight: 800; white-space: nowrap; display: block; width: 100%; text-transform: uppercase; }
        .sad-dashboard { background: rgba(0, 0, 0, 0.99); border: 2px solid #ff0000; border-radius: 50px; padding: 30px 15px; margin-top: 40px; margin-bottom: 100px; box-shadow: 0 0 50px rgba(255,0,0,0.5); }
        .user-item-card { background: rgba(255, 255, 255, 0.02); padding: 18px; border-radius: 25px; margin-bottom: 15px; border: 1px solid #222; }
        .control-grid { display: grid; grid-template-columns: 1.4fr 1fr 1fr 1fr 1fr; gap: 6px; margin-top: 12px; }
        .btn-mini { height: 42px; border-radius: 12px; border: none; font-size: 14px; font-weight: 900; color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; line-height: 1; }
        .role-badge { font-size: 9px; padding: 4px 10px; border-radius: 6px; font-weight: 900; text-transform: uppercase; margin-left: 10px; display: inline-block; }
        .role-sad { background: #f00; color: #fff; border: 1px solid #fff; }
        .role-ad { background: #ffd700; color: #000; }
        .role-mem { background: #2196f3; color: #fff; }
    </style>
</head>
<body>

<div id="loginPanel">
    <div class="login-card">
        <h1 style="color:#ffd700; text-transform: uppercase; letter-spacing: 5px; margin-bottom: 8px; font-size: 32px;">Royal Casino</h1>
        <div id="logStatusText">ƒêANG K·∫æT N·ªêI M√ÅY CH·ª¶ ROYAL...</div>
        <div id="authForm" style="display:none;">
            <input type="text" id="username" class="sad-input" placeholder="T√™n t√†i kho·∫£n">
            <input type="password" id="password" class="sad-input" placeholder="M·∫≠t kh·∫©u (√≠t nh·∫•t 6 k√Ω t·ª±)">
            <button onclick="register()" class="btn-main">ƒêƒÇNG K√ù NH·∫¨N 1M$</button>
            <button onclick="login()" style="width:100%; padding:18px; background:none; color:#555; border:none; cursor:pointer; margin-top:20px; font-weight:bold;">ƒê√É C√ì T√ÄI KHO·∫¢N? ƒêƒÇNG NH·∫¨P</button>
        </div>
    </div>
</div>

<div id="lobbyPanel" style="display:none;">
    <div class="marquee-box"><div id="marqueeText" class="marquee-text">Ch√†o m·ª´ng qu√Ω kh√°ch ƒë·∫øn v·ªõi Royal Casino!</div></div>
    <div id="lockBanner">‚ö†Ô∏è M√ÅY CH·ª¶ ƒêANG B·∫¢O TR√å - TR√í CH∆†I T·∫†M KH√ìA ‚ö†Ô∏è</div>

    <div style="padding:45px 20px; border-radius:50px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,215,0,0.3); margin-bottom:35px; text-align:center;">
        <div id="myRankDisplay" class="role-badge">MEMBER</div>
        <h2 id="lobbyName" style="color:#ffd700; margin-top:10px; margin-bottom:15px; font-size:30px; font-weight:900;">--</h2>
        <div style="color:#888; font-size:12px; font-weight:900; letter-spacing:2px; margin-bottom:5px; text-transform:uppercase;">S·ªê D∆Ø T√ÄI KHO·∫¢N</div>
        <div id="lobbyMoney" style="font-size:38px; color:#4caf50; font-weight:900; margin-bottom:30px;">0 $</div>
        <button onclick="logout()" style="background:rgba(204,0,0,0.15); color:#ff5252; border:1px solid #ff5252; padding:18px 50px; border-radius:22px; font-weight:bold; cursor:pointer;">ƒêƒÇNG XU·∫§T</button>
    </div>

    <div id="btnPlay" onclick="enterGame()" class="btn-play-card">
        <div style="font-size:75px; margin-bottom:15px;">üé≤</div>
        <h3 id="btnPlayTitle" style="color: #ffd700; margin: 0; font-size: 26px; font-weight: 900; letter-spacing: 3px;">V√ÄO S√íNG T√ÄI X·ªàU</h3>
        <span class="slogan-ultimate">N∆†I ANH H√ôNG H·ªòI T·ª§ - B·∫¢N Lƒ®NH ƒê·ªäNH GIANG S∆†N</span>
    </div>

    <div style="background: rgba(10, 10, 10, 0.99); border: 1px solid rgba(255, 215, 0, 0.35); border-radius: 45px; padding: 35px 25px; margin-bottom: 40px;">
        <h3 style="color:#ffd700; text-align:center; margin-top:0; font-size:18px; border-bottom:1px solid #333; padding-bottom:22px; text-transform:uppercase;">üèÜ Top 10 ƒê·∫°i Gia</h3>
        <div id="top10List"></div>
    </div>

    <div id="sadDashboard" class="sad-dashboard" style="display:none;">
        <div style="color:#f00; font-weight:900; text-align:center; margin-bottom:35px; font-size:22px; text-transform:uppercase;">Master Control Center</div>
        <div style="background: rgba(255,255,255,0.03); padding: 30px 20px; border-radius: 35px; border: 1px solid #333; margin-bottom: 35px;">
            <div id="srvStatusDisp" style="text-align:center; font-size:12px; font-weight:900; padding:12px; border-radius:15px; margin-bottom:20px; text-transform:uppercase;">TR·∫†NG TH√ÅI: --</div>
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button id="btnLock" onclick="srvLock(true)" class="btn-mini" style="flex:1; height:50px; background:#b71c1c;">KH√ìA M√ÅY</button>
                <button id="btnUnlock" onclick="srvLock(false)" class="btn-mini" style="flex:1; height:50px; background:#2e7d32;">M·ªû M√ÅY</button>
            </div>
            <input type="text" id="newNotice" class="sad-input" style="font-size:14px;" placeholder="Th√¥ng b√°o m·ªõi...">
            <button onclick="updateNotice()" style="width:100%; background:#1565c0; color:#fff; border:none; padding:20px; border-radius:20px; font-weight:bold;">C·∫¨P NH·∫¨T TO√ÄN SERVER</button>
        </div>
        <div id="masterUserList"></div>
    </div>
</div>

<script>
const firebaseConfig = { apiKey: "AIzaSyCbESIH8uq5Q6R45ehisGp-Lsh9xz_ejDk", authDomain: "tx888-85658.firebaseapp.com", databaseURL: "https://tx888-85658-default-rtdb.firebaseio.com", projectId: "tx888-85658", storageBucket: "tx888-85658.firebasestorage.app", messagingSenderId: "246211516842", appId: "1:246211516842:web:24a3598d54b037676c73d3" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database(), auth = firebase.auth();
let userData = null, isServerLocked = false, inputCache = {};

function formatMoney(n) {
    if (n < 1000) return n + " $";
    if (n < 1000000) return (n / 1000).toFixed(n % 1000 === 0 ? 0 : 1) + "k";
    if (n < 1000000000) return (n / 1000000).toFixed(n % 1000000 === 0 ? 0 : 1) + "M";
    return (n / 1000000000).toFixed(n % 1000000000 === 0 ? 0 : 1) + "B";
}

// L·ªÜNH M·ªû FILE GAME
function enterGame() {
    if(isServerLocked && !userData.isSuperAdmin && !userData.isAdmin) {
        return alert("M√ÅY CH·ª¶ ƒêANG B·∫¢O TR√å!");
    }
    window.location.href = "index2.html"; 
}

function editM(id, t) {
    const inputField = document.getElementById("amt_" + id);
    const val = parseInt(inputField.value);
    if (isNaN(val) || val <= 0) return alert("Nh·∫≠p ti·ªÅn!");
    inputField.disabled = true;
    db.ref('users/' + id + '/money').once('value').then(snap => {
        let n = (t === 1) ? (snap.val() + val) : (snap.val() - val);
        return db.ref('users/' + id).update({ money: Math.max(0, n) });
    }).then(() => { inputField.disabled = false; inputField.value = ""; inputCache[id] = ""; });
}

function updateSrvButtons(locked) {
    if (!userData || !userData.isSuperAdmin) return;
    const label = document.getElementById("srvStatusDisp");
    const bLock = document.getElementById("btnLock");
    const bUnlock = document.getElementById("btnUnlock");
    if (locked) {
        label.innerText = "TR·∫†NG TH√ÅI: ƒê√É KH√ìA"; label.style.background = "rgba(255,0,0,0.2)"; label.style.color = "#f44";
        bLock.style.boxShadow = "0 0 20px #f00"; bUnlock.style.boxShadow = "none";
    } else {
        label.innerText = "TR·∫†NG TH√ÅI: ƒêANG M·ªû"; label.style.background = "rgba(0,255,0,0.15)"; label.style.color = "#0f0";
        bUnlock.style.boxShadow = "0 0 20px #00c853"; bLock.style.boxShadow = "none";
    }
}

db.ref('server').on('value', s => {
    const data = s.val() || { isLocked: false, notice: "Welcome!" };
    isServerLocked = data.isLocked;
    const banner = document.getElementById("lockBanner");
    if(banner) banner.style.display = isServerLocked ? "block" : "none";
    document.getElementById("marqueeText").innerText = data.notice;
    const bPlay = document.getElementById("btnPlay");
    if (isServerLocked) { bPlay.style.opacity = "0.3"; document.getElementById("btnPlayTitle").innerText = "M√ÅY CH·ª¶ B·∫¢O TR√å"; }
    else { bPlay.style.opacity = "1"; document.getElementById("btnPlayTitle").innerText = "V√ÄO S√íNG T√ÄI X·ªàU"; }
    updateSrvButtons(isServerLocked);
});

auth.onAuthStateChanged(user => {
    const stBox = document.getElementById("logStatusText");
    const aForm = document.getElementById("authForm");
    if (user) {
        stBox.innerText = "ƒê√É PH√ÅT HI·ªÜN THI·∫æT B·ªä G·∫¶N ƒê√ÇY!";
        db.ref('users/' + user.uid).on('value', s => {
            userData = s.val(); if(!userData) return;
            userData.uid = user.uid;
            document.getElementById("loginPanel").style.display = "none";
            document.getElementById("lobbyPanel").style.display = "block";
            document.getElementById("lobbyName").innerText = userData.username;
            document.getElementById("lobbyMoney").innerText = formatMoney(userData.money);
            const rDisp = document.getElementById("myRankDisplay");
            if(userData.isSuperAdmin) { rDisp.innerText = "ADMIN T·ªêI CAO"; rDisp.className = "role-badge role-sad"; }
            else if(userData.isAdmin) { rDisp.innerText = "ADMIN"; rDisp.className = "role-badge role-ad"; }
            else { rDisp.innerText = "MEMBER"; rDisp.className = "role-badge role-mem"; }
            if(userData.isSuperAdmin) { document.getElementById("sadDashboard").style.display = "block"; loadMasterControl(); updateSrvButtons(isServerLocked); }
            loadTop10();
        });
    } else {
        setTimeout(() => { stBox.innerText = "K·∫æT N·ªêI TH√ÄNH C√îNG!"; aForm.style.display = "block"; }, 1500);
    }
});

function saveInput(id, val) { inputCache[id] = val; }

function loadMasterControl() {
    db.ref('users').on('value', snap => {
        let html = ""; const data = snap.val();
        let arr = []; for(let id in data) { arr.push({id, ...data[id]}); }
        arr.sort((a,b) => b.money - a.money);
        arr.forEach(u => {
            const hideDel = u.isSuperAdmin ? 'display:none;' : 'display:flex;';
            const adColor = u.isAdmin ? "#ffd700" : "#444";
            const currentInputVal = inputCache[u.id] || ""; 
            html += `<div class="user-item-card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <b style="font-size:14px; color:#ffd700;">${u.username} ${u.isSuperAdmin?'<span class="role-badge role-sad">SAD</span>':(u.isAdmin?'<span class="role-badge role-ad">AD</span>':'')}</b>
                <span style="color:#4caf50; font-weight:bold;">${formatMoney(u.money)}</span>
            </div>
            <div class="control-grid">
                <input type="number" id="amt_${u.id}" class="sad-input" style="padding:10px; margin:0; font-size:12px; height:42px;" 
                placeholder="$$" value="${currentInputVal}" oninput="saveInput('${u.id}', this.value)">
                <button onclick="editM('${u.id}',1)" class="btn-mini" style="background:green;">+</button>
                <button onclick="editM('${u.id}',-1)" class="btn-mini" style="background:red;">-</button>
                <button onclick="toggleAD('${u.id}',${u.isAdmin})" class="btn-mini" style="background:${adColor}; color:${u.isAdmin?'#000':'#fff'};">AD</button>
                <button onclick="delN('${u.id}')" class="btn-mini" style="background:#333; ${hideDel}">X</button>
            </div></div>`;
        });
        document.getElementById("masterUserList").innerHTML = html;
    });
}

function srvLock(s) { db.ref('server').update({ isLocked: s }); }
function updateNotice() { const n = document.getElementById("newNotice").value; if(n) db.ref('server').update({ notice: n }).then(()=>alert("ƒê√£ l∆∞u!")); }
function toggleAD(id, c) { db.ref('users/'+id).update({ isAdmin: !c }); }
function delN(id) { if(confirm("X√≥a vƒ©nh vi·ªÖn?")) db.ref('users/'+id).remove(); }
function logout() { auth.signOut().then(() => location.reload()); }

function login() { 
    const u = document.getElementById("username").value.trim().toLowerCase(), p = document.getElementById("password").value.trim();
    if(!u || !p) return alert("Nh·∫≠p ƒë·ªß!");
    document.getElementById("logStatusText").innerText = "ƒêANG X√ÅC TH·ª∞C...";
    auth.signInWithEmailAndPassword(u + "@casino.com", p).catch(() => { alert("Sai th√¥ng tin!"); document.getElementById("logStatusText").innerText = "K·∫æT N·ªêI TH√ÄNH C√îNG!"; }); 
}

function register() {
    const u = document.getElementById("username").value.trim().toLowerCase(), p = document.getElementById("password").value.trim();
    if(u.length < 3) return alert("T√™n qu√° ng·∫Øn!");
    if(p.length < 6) return alert("M·∫≠t kh·∫©u √≠t nh·∫•t 6 k√Ω t·ª±!");
    db.ref('users').orderByChild('username').equalTo(u).once('value', snapshot => {
        if(snapshot.exists()) { alert("T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i!"); } 
        else {
            auth.createUserWithEmailAndPassword(u + "@casino.com", p).then(r => {
                db.ref('users/'+r.user.uid).set({username:u, money:1000000, isAdmin:false, isSuperAdmin:false});
            }).catch(e => alert("L·ªói: " + e.message));
        }
    });
}

function loadTop10() {
    db.ref('users').orderByChild('money').limitToLast(10).on('value', snap => {
        let list = []; snap.forEach(c => { list.push(c.val()); });
        list.reverse();
        let h = ""; list.forEach((u, i) => {
            let rc = u.isSuperAdmin ? "role-sad" : (u.isAdmin ? "role-ad" : "role-mem");
            let rn = u.isSuperAdmin ? "SAD" : (u.isAdmin ? "AD" : "Mem");
            h += `<div style="display:flex; justify-content:space-between; padding:18px 0; border-bottom:1px solid #222;">
                <span>${i+1}. <b>${u.username}</b> <span class="role-badge ${rc}">${rn}</span></span>
                <b style="color:#4caf50;">${formatMoney(u.money)}</b>
            </div>`;
        });
        document.getElementById("top10List").innerHTML = h;
    });
}
</script>
</body>
</html>
