<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CrashX - Ultimate Edition</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; margin: 0; padding: 0; user-select: none; }
        body { background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; height: 100svh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* HEADER - CHU·∫®N ƒê∆†N V·ªä TI·ªÄN T·ª™ S·∫¢NH */
        .header { height: 55px; padding: 0 15px; background: #0b0e11; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #1e2329; flex-shrink: 0; }
        #userMoney { color: #00ff88; font-weight: 900; font-size: 16px; }

        /* GAME AREA */
        #gameArea { position: relative; flex: 1; width: 100%; background: #020b16; overflow: hidden; }

        /* N·ªÄN V≈® TR·ª§ DI CHUY·ªÇN */
        .sky-bg {
            position: absolute; width: 300%; height: 300%; top: -100%; left: -100%;
            background-image: 
                radial-gradient(1.5px 1.5px at 50px 80px, #fff, rgba(0,0,0,0)),
                radial-gradient(2px 2px at 150px 250px, #00f2fe, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 300px 50px, #fff, rgba(0,0,0,0));
            background-size: 300px 300px;
            opacity: 0; transition: opacity 1s; z-index: 1;
        }
        .sky-active { opacity: 1; animation: moveSky 1.5s linear infinite; }
        @keyframes moveSky { from { transform: translate(0, 0); } to { transform: translate(-150px, 150px); } }

        /* ROCKET */
        #rocket { position: absolute; font-size: 45px; bottom: 30px; left: 30px; z-index: 10; transition: transform 0.1s linear, bottom 0.1s linear, left 0.1s linear; }
        #displayCenter { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 100%; z-index: 20; }
        #multiNum { font-size: 65px; font-weight: 900; color: #fff; text-shadow: 0 0 25px rgba(255,255,255,0.3); }
        #countdown { color: #ffd700; font-size: 16px; font-weight: bold; margin-top: 5px; }

        /* B·∫¢NG ƒêI·ªÄU KHI·ªÇN - SONG SONG CHU·∫®N MOBILE */
        .controls-wrapper { 
            height: 145px; background: #0b0e11; padding: 10px; display: grid; 
            grid-template-columns: 1fr 1fr; gap: 10px; border-top: 1px solid #1e2329; flex-shrink: 0;
        }
        .bet-card { background: #1e2329; border-radius: 12px; padding: 8px; display: flex; flex-direction: column; justify-content: space-between; min-width: 0; border: 1px solid #2b3139; }
        .input-box { display: flex; justify-content: space-between; align-items: center; background: #000; border-radius: 6px; padding: 6px 10px; margin-bottom: 5px; }
        .input-box span { color: #848e9c; font-size: 20px; font-weight: bold; cursor: pointer; }
        .input-box b { font-size: 14px; color: #fff; }

        .btn-main { width: 100%; height: 50px; border-radius: 8px; border: none; font-weight: 900; font-size: 14px; text-transform: uppercase; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .btn-bet { background: #005a34; color: #00ff88; border: 1px solid #00ff88; }
        .btn-cancel { background: #b71c1c; color: #fff; }
        .btn-cashout { background: #00c853; color: #fff; box-shadow: 0 0 12px #00c853; }
        .btn-done { background: #2b3139; color: #555; }
        .btn-main span { font-size: 8px; opacity: 0.8; font-weight: normal; margin-top: 2px; }
    </style>
</head>
<body>

<div class="header">
    <button onclick="window.location.href='index.html'" style="background:none; border:none; color:#848e9c; font-size:24px;">‚úï</button>
    <div id="userMoney">0 $</div>
    <div>‚öôÔ∏è</div>
</div>

<div id="gameArea">
    <div id="skyBg" class="sky-bg"></div>
    <div id="displayCenter">
        <h1 id="multiNum">1.00x</h1>
        <div id="countdown"></div>
    </div>
    <div id="rocket">üöÄ</div>
</div>

<div class="controls-wrapper">
    <div class="bet-card">
        <div class="input-box"><span onclick="adjust(1,-100000)">‚àí</span><b id="betTxt1">100K</b><span onclick="adjust(1,100000)">+</span></div>
        <button id="btn1" onclick="act(1)" class="btn-main btn-bet">C∆Ø·ª¢C<span>V√≤ng t·ªõi</span></button>
    </div>
    <div class="bet-card">
        <div class="input-box"><span onclick="adjust(2,-100000)">‚àí</span><b id="betTxt2">100K</b><span onclick="adjust(2,100000)">+</span></div>
        <button id="btn2" onclick="act(2)" class="btn-main btn-bet">C∆Ø·ª¢C<span>V√≤ng t·ªõi</span></button>
    </div>
</div>

<script>
// Firebase Config
const firebaseConfig = { apiKey: "AIzaSyCbESIH8uq5Q6R45ehisGp-Lsh9xz_ejDk", authDomain: "tx888-85658.firebaseapp.com", databaseURL: "https://tx888-85658-default-rtdb.firebaseio.com", projectId: "tx888-85658", storageBucket: "tx888-85658.firebasestorage.app", messagingSenderId: "246211516842", appId: "1:246211516842:web:24a3598d54b037676c73d3" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database(), auth = firebase.auth();

let userData = null, isPlaying = false, isWaiting = true, currentX = 1.00, crashX = 0;
let bets = { 1: { amt: 100000, active: false, cashed: false }, 2: { amt: 100000, active: false, cashed: false } };

function nFormatter(num) {
    if (num >= 1000000000000) return (num / 1000000000000).toFixed(1) + 'T';
    if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
    if (num >= 1000) return (num / 1000).toFixed(0) + 'K';
    return num;
}

auth.onAuthStateChanged(user => {
    if (user) {
        db.ref('users/' + user.uid).on('value', s => {
            userData = s.val(); userData.uid = user.uid;
            document.getElementById('userMoney').innerText = nFormatter(userData.money) + " $";
        });
    } else { window.location.href = "index.html"; }
});

function adjust(n, v) {
    if(isPlaying || (isWaiting && bets[n].active)) return;
    bets[n].amt = Math.max(100000, bets[n].amt + v);
    document.getElementById('betTxt'+n).innerText = nFormatter(bets[n].amt);
}

function startWaiting() {
    isWaiting = true; isPlaying = false;
    let t = 10;
    document.getElementById('skyBg').classList.remove('sky-active');
    document.getElementById('multiNum').innerText = "V√ÄO C∆Ø·ª¢C";
    document.getElementById('multiNum').style.color = "#fff";
    document.getElementById('rocket').innerText = "üöÄ";
    document.getElementById('rocket').style.bottom = "30px";
    document.getElementById('rocket').style.left = "30px";
    document.getElementById('rocket').style.transform = "rotate(0deg)";

    let timer = setInterval(() => {
        document.getElementById('countdown').innerText = "B·∫ÆT ƒê·∫¶U TRONG " + t + "S";
        if(t <= 0) { clearInterval(timer); document.getElementById('countdown').innerText = ""; startFlying(); }
        t--;
    }, 1000);
}

function startFlying() {
    isWaiting = false; isPlaying = true;
    currentX = 1.00;
    crashX = (100 / (100 - (Math.random() * 97))).toFixed(2);
    
    [1,2].forEach(n => {
        let b = document.getElementById('btn'+n);
        if(bets[n].active) {
            b.className = "btn-main btn-cashout";
            b.innerHTML = "R√öT TI·ªÄN<span>" + nFormatter(bets[n].amt) + "</span>";
        } else { b.className = "btn-main btn-done"; b.innerHTML = "ƒêANG BAY<span>...</span>"; }
    });

    let loop = setInterval(() => {
        currentX += 0.01 + (currentX / 140);
        document.getElementById('multiNum').innerText = currentX.toFixed(2) + "x";
        [1,2].forEach(n => { if(bets[n].active && !bets[n].cashed) document.getElementById('btn'+n).innerHTML = "R√öT TI·ªÄN<span>+" + nFormatter(Math.floor(bets[n].amt * currentX)) + "</span>"; });
        
        let r = document.getElementById('rocket');
        let limit = 150; // ƒêi·ªÉm trung t√¢m
        let pos = (currentX - 1) * 60;

        if (pos < limit) {
            r.style.bottom = (30 + pos * 0.8) + "px";
            r.style.left = (30 + pos * 1.2) + "px";
            r.style.transform = "rotate(-45deg)";
        } else {
            r.style.bottom = (30 + limit * 0.8) + "px";
            r.style.left = (30 + limit * 1.2) + "px";
            document.getElementById('skyBg').classList.add('sky-active');
            r.style.transform = `rotate(-45deg) translate(${Math.random()*1}px, ${Math.random()*1}px)`;
        }

        if(currentX >= crashX) { clearInterval(loop); crash(); }
    }, 100);
}

function act(n) {
    let b = document.getElementById('btn'+n);
    if(isWaiting && !bets[n].active) {
        if(userData.money < bets[n].amt) return alert("Kh√¥ng ƒë·ªß ti·ªÅn!");
        bets[n].active = true; bets[n].cashed = false;
        db.ref('users/'+userData.uid).update({ money: userData.money - bets[n].amt });
        b.className = "btn-main btn-cancel";
        b.innerHTML = "H·ª¶Y<span>" + nFormatter(bets[n].amt) + "</span>";
    } else if(isWaiting && bets[n].active) {
        bets[n].active = false;
        db.ref('users/'+userData.uid).update({ money: userData.money + bets[n].amt });
        b.className = "btn-main btn-bet";
        b.innerHTML = "C∆Ø·ª¢C<span>V√≤ng t·ªõi</span>";
    } else if(isPlaying && bets[n].active && !bets[n].cashed) {
        let win = Math.floor(bets[n].amt * currentX);
        db.ref('users/'+userData.uid).update({ money: userData.money + win });
        bets[n].cashed = true;
        b.className = "btn-main btn-done";
        b.innerHTML = "ƒê√É R√öT<span>+" + nFormatter(win) + "</span>";
    }
}

function crash() {
    isPlaying = false;
    document.getElementById('skyBg').classList.remove('sky-active');
    document.getElementById('multiNum').innerText = "üí• " + currentX.toFixed(2);
    document.getElementById('multiNum').style.color = "#ff4d4d";
    document.getElementById('rocket').innerText = "üí•";
    
    setTimeout(() => {
        [1,2].forEach(n => {
            bets[n].active = false; bets[n].cashed = false;
            let b = document.getElementById('btn'+n);
            b.className = "btn-main btn-bet";
            b.innerHTML = "C∆Ø·ª¢C<span>V√≤ng t·ªõi</span>";
        });
        startWaiting();
    }, 2500);
}

startWaiting();
</script>
</body>
</html>
